<!DOCTYPE html>
<html>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<head>
    <title>{{ tracker['name'] }} Tracker Details</title>
    <style>
        table, th, td {
          border: 1px solid black;
          border-collapse: collapse;
        }
    </style>
</head>
<body>
<h1>Hello {{ username }}!</h1>
<div style="text-align:center;">
<a href="/logout">logout</a>
</div>
<div style="text-align:left;">
<a href="/tracker">Back to Trackers</a>
</div>
<h2>{{ tracker['name'] }} - Tracker</h2>
<label for="period">Filter</label>
<select name="period" id="period" onchange="redirect({{ tracker['id'] }}, document.getElementById('period').value)">
  <option value="1" {% if last_days==1%}selected='selected'{% endif %}>Last 24 hours</option>
  <option value="7" {% if last_days==7%}selected='selected'{% endif %}>Last 7 days</option>
  <option value="30" {% if last_days==30%}selected='selected'{% endif %}>Last 30 days</option>
</select>
<div id="tracking-graph">
<span id="myPlot" style="width:100%;max-width:700px"></span>
</div>
<h2>Logs</h2>
<table id = "tracker-logs">
<thead>
<th>On</th>
<th>Value</th>
<th></th>
<th></th>
<th></th>
</thead>
<tbody>
{% for log in logs%}
<tr>
    <td>{{ log['timestamp'] }}</td>
    <td>{{ log['value'] }}</td>
    <td>{{ log['note'] }}</td>
    <td><a href="/tracker/{{ tracker['id'] }}/log/{{ log['id'] }}/update">Update</a></td>
    <td><a href="/tracker/{{ tracker['id'] }}/log/{{ log['id'] }}/delete">Delete</a></td>
</tr>
{% endfor %}
</tbody>
</table>

<script type="text/javascript">
    function redirect(tracking_id, value){
        window.location.href=tracking_id.toString().concat('?lastdays=').concat(value);
    }
    function plot(xArray,yArray, type, settings) {
        //console.log(type);
        // Define Layout
        var layout = {
          xaxis: {title: "Time stamp"},
          yaxis: {title: "Value"},
          title: "Trend line"
        };
        var data;
        if (type=='boolean') {
             data = [{
              x: xArray,
              y: yArray,
              mode:"lines"
            }];
        } else if (type=='choice') {
             //console.log(yArray)
             settingsList=settings.split(',');
             data = [];
             settingsList.forEach(function(setting){
                choicesList=[]
                yArray.forEach(function(options) {
                    if(options.includes(setting)){
                        choicesList.push(1);
                    } else {
                        choicesList.push(0);
                    }
                });
                data.push({
                      x: xArray,
                      y: choicesList,
                      type:"bar",
                      name:setting
                });
              });

            layout.barmode='stack'
        } else {
             data = [{
              x: xArray,
              y: yArray,
              mode:"lines"
            }];
        }
        // Display using Plotly
        console.log(data)
        Plotly.newPlot("myPlot", data, layout);
    }
    plot({{ timestamps|safe }},{{ values|safe }}, '{{ tracker['type'] }}', '{{ tracker['settings'] }}')
</script>
</body>
</html>